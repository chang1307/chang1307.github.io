<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ…¢æ€§è™•æ–¹ç®‹é ˜è—¥æ™‚é–“è¨ˆç®—å™¨ | Chronic Prescription Refill Calculator | MÃ¡y TÃ­nh Thá»i Gian LÄ©nh Thuá»‘c</title>
  
  <!-- å¤šèªè¨€SEOå„ªåŒ– -->
  <link rel="alternate" hreflang="zh-TW" href="https://example.com/index.html">
  <link rel="alternate" hreflang="en-US" href="https://example.com/en.html">
  <link rel="alternate" hreflang="vi-VN" href="https://example.com/vi.html">
  
  <!-- Reactå’Œç›¸é—œä¾è³´ -->
  <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Microsoft JhengHei', Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #f5f5f5;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideDown {
      from { 
        opacity: 0;
        transform: translateY(-10px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .flag-button {
      background: transparent;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 20px;
      transition: all 0.2s;
    }
    
    .flag-button.active {
      border: 2px solid #4299e1;
      opacity: 1;
    }
    
    .flag-button:not(.active) {
      opacity: 0.7;
    }
    
    .flag-button:hover {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    // èªè¨€æ•¸æ“š
    const translations = {
      'zh-TW': {
        title: 'æ…¢æ€§è™•æ–¹ç®‹é ˜è—¥æ™‚é–“è¨ˆç®—å™¨',
        firstVisitDate: 'çœ‹è¨ºæ—¥æœŸ (ç¬¬ä¸€æ¬¡é ˜è—¥æ—¥æœŸ)',
        prescriptionDays: 'æ…¢æ€§è™•æ–¹ç®‹å¤©æ•¸',
        refillTimes: 'æœ¬æ…¢ç®‹å¯é ˜è—¥æ¬¡æ•¸',
        actualSecondRefillDate: 'å¯¦éš›ç¬¬äºŒæ¬¡é ˜è—¥æ—¥æœŸ (é¸å¡«ï¼Œè‹¥å·²éç¬¬äºŒæ¬¡é ˜è—¥)',
        calculateButton: 'è¨ˆç®—é ˜è—¥èˆ‡å›è¨ºæ™‚é–“',
        calculating: 'è¨ˆç®—ä¸­...',
        results: 'è¨ˆç®—çµæœ',
        prescriptionInfo: 'è™•æ–¹è³‡è¨Š',
        firstRefillDate: 'é¦–æ¬¡é ˜è—¥æ—¥æœŸ',
        validityEndDate: 'è™•æ–¹æœ‰æ•ˆæœŸé™',
        validityEndDateSuffix: '(é¦–æ¬¡é ˜è—¥å¾Œ90å¤©)',
        secondRefill: 'ç¬¬äºŒæ¬¡é ˜è—¥',
        earliestRefillDate: 'æœ€æ—©å¯é ˜è—¥æ—¥æœŸ',
        remainingLessThan10Days: '(è—¥å“å‰©é¤˜<10å¤©æ™‚)',
        standardRefillDate: 'æ¨™æº–é ˜è—¥æ—¥æœŸ',
        medicationEmptyDate: '(è—¥å“ç”¨å®Œæ™‚)',
        actualRefillDate: 'å¯¦éš›é ˜è—¥æ—¥æœŸ',
        thirdRefill: 'ç¬¬ä¸‰æ¬¡é ˜è—¥',
        fourthRefill: 'ç¬¬å››æ¬¡é ˜è—¥',
        refillDateInvalid: 'æ­¤æ¬¡é ˜è—¥æ™‚é–“å·²è¶…éè™•æ–¹ç®‹æœ‰æ•ˆæœŸé™ï¼Œç„¡æ³•é ˜è—¥ã€‚è«‹é‡æ–°å›è¨ºé–‹ç«‹è™•æ–¹ã€‚',
        nextVisit: 'ä¸‹æ¬¡å›è¨ºæ™‚é–“',
        earliestNextVisitDate: 'æœ€æ—©å¯å›è¨ºæ—¥æœŸ',
        standardNextVisitDate: 'æ¨™æº–å›è¨ºæ—¥æœŸ',
        days: 'å¤©',
        times: 'æ¬¡',
        yearSelector: 'é¸æ“‡å¹´ä»½',
        monthSelector: 'é¸æ“‡æœˆä»½',
        daySelector: 'é¸æ“‡æ—¥æœŸ',
        year: 'å¹´',
        month: 'æœˆ',
        day: 'æ—¥',
        selectYear: 'è«‹é¸æ“‡å¹´ä»½',
        selectMonth: 'è«‹é¸æ“‡æœˆä»½',
        selectDay: 'è«‹é¸æ“‡æ—¥æœŸ',
        pleaseSelectVisitDate: 'è«‹å¡«å¯«çœ‹è¨ºæ—¥æœŸ',
        instruction: 'èªªæ˜',
        instruction1: 'æ ¹æ“šå°ç£å¥ä¿åˆ¶åº¦ï¼Œæ…¢æ€§ç—…é€£çºŒè™•æ–¹ç®‹è¦å®šï¼š',
        instruction2: 'æ…¢æ€§è™•æ–¹ç®‹æœ‰æ•ˆæœŸé™ç‚ºé¦–æ¬¡é ˜è—¥æ—¥èµ·90å¤©å…§',
        instruction3: 'ä¸€èˆ¬è™•æ–¹å¤©æ•¸ç‚º21å¤©è‡³30å¤©',
        instruction4: 'å¯é ˜è—¥æ¬¡æ•¸é€šå¸¸ç‚º2è‡³4æ¬¡ï¼ˆåƒ…21-22å¤©è™•æ–¹å¯é ˜4æ¬¡ï¼‰',
        instruction5: 'æœ€æ—©å¯æ–¼è—¥å“å‰©é¤˜<10å¤©æ™‚æå‰é ˜è—¥',
        instruction6: 'å¦‚æœå»¶é²é ˜è—¥ï¼Œå¾ŒçºŒé ˜è—¥æ™‚é–“æœƒé †å»¶ï¼Œä½†å¿…é ˆåœ¨90å¤©æœ‰æ•ˆæœŸå…§å®Œæˆæ‰€æœ‰é ˜è—¥',
        usage: 'ä½¿ç”¨æ–¹æ³•',
        usage1: 'è¼¸å…¥é¦–æ¬¡çœ‹è¨º/é ˜è—¥æ—¥æœŸ',
        usage2: 'é¸æ“‡æ…¢æ€§è™•æ–¹ç®‹å¤©æ•¸',
        usage3: 'é¸æ“‡å¯é ˜è—¥æ¬¡æ•¸',
        usage4: 'è‹¥å·²éç¬¬äºŒæ¬¡é ˜è—¥ï¼Œå¯é¸å¡«å¯¦éš›ç¬¬äºŒæ¬¡é ˜è—¥æ—¥æœŸï¼Œç³»çµ±æœƒæ“šæ­¤èª¿æ•´å¾ŒçºŒæ—¥æœŸ',
        usage5: 'é»æ“Šè¨ˆç®—æŒ‰éˆ•å³å¯ç²å¾—é ˜è—¥å’Œå›è¨ºæ™‚é–“',
        caution: 'æ³¨æ„',
        cautionText: 'æ­¤è¨ˆç®—å™¨åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›é ˜è—¥æ™‚é–“å¯èƒ½å—é†«é™¢æˆ–è—¥å±€ç‡Ÿæ¥­æ™‚é–“ã€å‡æ—¥ç­‰å› ç´ å½±éŸ¿ã€‚è«‹ä¾ç…§é†«å›‘æŒ‰æ™‚æœè—¥ä¸¦é©æ™‚å›è¨ºã€‚'
      },
      'en-US': {
        title: 'Chronic Prescription Refill Calculator',
        firstVisitDate: 'First Visit Date (First Refill Date)',
        prescriptionDays: 'Prescription Days',
        refillTimes: 'Number of Refills Allowed',
        actualSecondRefillDate: 'Actual Second Refill Date (Optional)',
        calculateButton: 'Calculate Refill & Visit Dates',
        calculating: 'Calculating...',
        results: 'Results',
        prescriptionInfo: 'Prescription Information',
        firstRefillDate: 'First Refill Date',
        validityEndDate: 'Prescription Validity End Date',
        validityEndDateSuffix: '(90 days after first refill)',
        secondRefill: 'Second Refill',
        earliestRefillDate: 'Earliest Refill Date',
        remainingLessThan10Days: '(when medication remaining < 10 days)',
        standardRefillDate: 'Standard Refill Date',
        medicationEmptyDate: '(when medication is empty)',
        actualRefillDate: 'Actual Refill Date',
        thirdRefill: 'Third Refill',
        fourthRefill: 'Fourth Refill',
        refillDateInvalid: 'This refill date exceeds the prescription validity period. Please visit your doctor for a new prescription.',
        nextVisit: 'Next Doctor Visit',
        earliestNextVisitDate: 'Earliest Visit Date',
        standardNextVisitDate: 'Standard Visit Date',
        days: 'days',
        times: 'times',
        yearSelector: 'Select Year',
        monthSelector: 'Select Month',
        daySelector: 'Select Day',
        year: 'Year',
        month: 'Month',
        day: 'Day',
        selectYear: 'Select Year',
        selectMonth: 'Select Month',
        selectDay: 'Select Day',
        pleaseSelectVisitDate: 'Please enter the first visit date',
        instruction: 'Instructions',
        instruction1: 'According to Taiwan\'s National Health Insurance regulations for chronic prescriptions:',
        instruction2: 'The prescription is valid for 90 days from the first refill date',
        instruction3: 'Standard prescription period is 21 to 30 days',
        instruction4: 'Number of refills allowed is typically 2 to 4 (only 21-22 day prescriptions can have 4 refills)',
        instruction5: 'Earliest refill is allowed when medication remaining is less than 10 days',
        instruction6: 'If refill is delayed, subsequent refill dates will be adjusted, but all refills must be completed within the 90-day validity period',
        usage: 'How to Use',
        usage1: 'Enter your first visit/refill date',
        usage2: 'Select the prescription days',
        usage3: 'Select the number of refills allowed',
        usage4: 'If you\'ve already had your second refill, you can enter the actual date to adjust subsequent dates',
        usage5: 'Click the calculate button to get refill and visit dates',
        caution: 'Caution',
        cautionText: 'This calculator is for reference only. Actual refill dates may be affected by hospital or pharmacy hours, holidays, etc. Please follow your doctor\'s instructions for medication and visits.'
      },
      'vi-VN': {
        title: 'MÃ¡y TÃ­nh Thá»i Gian LÄ©nh Thuá»‘c Theo ÄÆ¡n DÃ i Háº¡n',
        firstVisitDate: 'NgÃ y KhÃ¡m (NgÃ y LÄ©nh Thuá»‘c Äáº§u TiÃªn)',
        prescriptionDays: 'Sá»‘ NgÃ y Thuá»‘c',
        refillTimes: 'Sá»‘ Láº§n LÄ©nh Thuá»‘c ÄÆ°á»£c PhÃ©p',
        actualSecondRefillDate: 'NgÃ y LÄ©nh Thuá»‘c Thá»© Hai Thá»±c Táº¿ (TÃ¹y Chá»n)',
        calculateButton: 'TÃ­nh ToÃ¡n NgÃ y LÄ©nh Thuá»‘c & TÃ¡i KhÃ¡m',
        calculating: 'Äang tÃ­nh toÃ¡n...',
        results: 'Káº¿t Quáº£',
        prescriptionInfo: 'ThÃ´ng Tin ÄÆ¡n Thuá»‘c',
        firstRefillDate: 'NgÃ y LÄ©nh Thuá»‘c Äáº§u TiÃªn',
        validityEndDate: 'NgÃ y Háº¿t Háº¡n ÄÆ¡n Thuá»‘c',
        validityEndDateSuffix: '(90 ngÃ y sau láº§n lÄ©nh thuá»‘c Ä‘áº§u tiÃªn)',
        secondRefill: 'LÄ©nh Thuá»‘c Láº§n Thá»© Hai',
        earliestRefillDate: 'NgÃ y LÄ©nh Thuá»‘c Sá»›m Nháº¥t',
        remainingLessThan10Days: '(khi thuá»‘c cÃ²n láº¡i < 10 ngÃ y)',
        standardRefillDate: 'NgÃ y LÄ©nh Thuá»‘c TiÃªu Chuáº©n',
        medicationEmptyDate: '(khi háº¿t thuá»‘c)',
        actualRefillDate: 'NgÃ y LÄ©nh Thuá»‘c Thá»±c Táº¿',
        thirdRefill: 'LÄ©nh Thuá»‘c Láº§n Thá»© Ba',
        fourthRefill: 'LÄ©nh Thuá»‘c Láº§n Thá»© TÆ°',
        refillDateInvalid: 'NgÃ y lÄ©nh thuá»‘c nÃ y vÆ°á»£t quÃ¡ thá»i háº¡n hiá»‡u lá»±c cá»§a Ä‘Æ¡n thuá»‘c. Vui lÃ²ng Ä‘áº¿n gáº·p bÃ¡c sÄ© Ä‘á»ƒ Ä‘Æ°á»£c cáº¥p Ä‘Æ¡n thuá»‘c má»›i.',
        nextVisit: 'Láº§n TÃ¡i KhÃ¡m Tiáº¿p Theo',
        earliestNextVisitDate: 'NgÃ y TÃ¡i KhÃ¡m Sá»›m Nháº¥t',
        standardNextVisitDate: 'NgÃ y TÃ¡i KhÃ¡m TiÃªu Chuáº©n',
        days: 'ngÃ y',
        times: 'láº§n',
        yearSelector: 'Chá»n NÄƒm',
        monthSelector: 'Chá»n ThÃ¡ng',
        daySelector: 'Chá»n NgÃ y',
        year: 'NÄƒm',
        month: 'ThÃ¡ng',
        day: 'NgÃ y',
        selectYear: 'Chá»n NÄƒm',
        selectMonth: 'Chá»n ThÃ¡ng',
        selectDay: 'Chá»n NgÃ y',
        pleaseSelectVisitDate: 'Vui lÃ²ng nháº­p ngÃ y khÃ¡m Ä‘áº§u tiÃªn',
        instruction: 'HÆ°á»›ng Dáº«n',
        instruction1: 'Theo quy Ä‘á»‹nh cá»§a Báº£o hiá»ƒm Y táº¿ Quá»‘c gia ÄÃ i Loan Ä‘á»‘i vá»›i Ä‘Æ¡n thuá»‘c dÃ i háº¡n:',
        instruction2: 'ÄÆ¡n thuá»‘c cÃ³ hiá»‡u lá»±c trong 90 ngÃ y ká»ƒ tá»« ngÃ y lÄ©nh thuá»‘c Ä‘áº§u tiÃªn',
        instruction3: 'Thá»i gian Ä‘Æ¡n thuá»‘c tiÃªu chuáº©n lÃ  21 Ä‘áº¿n 30 ngÃ y',
        instruction4: 'Sá»‘ láº§n lÄ©nh thuá»‘c Ä‘Æ°á»£c phÃ©p thÆ°á»ng lÃ  2 Ä‘áº¿n 4 (chá»‰ Ä‘Æ¡n thuá»‘c 21-22 ngÃ y cÃ³ thá»ƒ cÃ³ 4 láº§n lÄ©nh thuá»‘c)',
        instruction5: 'ÄÆ°á»£c phÃ©p lÄ©nh thuá»‘c sá»›m nháº¥t khi lÆ°á»£ng thuá»‘c cÃ²n láº¡i dÆ°á»›i 10 ngÃ y',
        instruction6: 'Náº¿u viá»‡c lÄ©nh thuá»‘c bá»‹ trÃ¬ hoÃ£n, ngÃ y lÄ©nh thuá»‘c tiáº¿p theo sáº½ Ä‘Æ°á»£c Ä‘iá»u chá»‰nh, nhÆ°ng táº¥t cáº£ cÃ¡c láº§n lÄ©nh thuá»‘c pháº£i Ä‘Æ°á»£c hoÃ n thÃ nh trong thá»i háº¡n hiá»‡u lá»±c 90 ngÃ y',
        usage: 'CÃ¡ch Sá»­ Dá»¥ng',
        usage1: 'Nháº­p ngÃ y khÃ¡m/lÄ©nh thuá»‘c Ä‘áº§u tiÃªn cá»§a báº¡n',
        usage2: 'Chá»n sá»‘ ngÃ y thuá»‘c',
        usage3: 'Chá»n sá»‘ láº§n lÄ©nh thuá»‘c Ä‘Æ°á»£c phÃ©p',
        usage4: 'Náº¿u báº¡n Ä‘Ã£ lÄ©nh thuá»‘c láº§n thá»© hai, báº¡n cÃ³ thá»ƒ nháº­p ngÃ y thá»±c táº¿ Ä‘á»ƒ Ä‘iá»u chá»‰nh cÃ¡c ngÃ y tiáº¿p theo',
        usage5: 'Nháº¥p vÃ o nÃºt tÃ­nh toÃ¡n Ä‘á»ƒ nháº­n ngÃ y lÄ©nh thuá»‘c vÃ  ngÃ y tÃ¡i khÃ¡m',
        caution: 'LÆ°u Ã',
        cautionText: 'MÃ¡y tÃ­nh nÃ y chá»‰ mang tÃ­nh tham kháº£o. NgÃ y lÄ©nh thuá»‘c thá»±c táº¿ cÃ³ thá»ƒ bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi giá» lÃ m viá»‡c cá»§a bá»‡nh viá»‡n hoáº·c hiá»‡u thuá»‘c, ngÃ y lá»…, v.v. Vui lÃ²ng lÃ m theo hÆ°á»›ng dáº«n cá»§a bÃ¡c sÄ© Ä‘á»ƒ uá»‘ng thuá»‘c vÃ  tÃ¡i khÃ¡m.'
      }
    };

    // åœ‹æ——åœ–æ¨™ï¼ˆä½¿ç”¨åœ‹å®¶ä»£ç¢¼è¡¨ç¤ºï¼‰
    const flags = {
      'zh-TW': 'ğŸ‡¹ğŸ‡¼',
      'en-US': 'ğŸ‡ºğŸ‡¸',
      'vi-VN': 'ğŸ‡»ğŸ‡³'
    };

    function LanguageSwitcher({ currentLang, onLanguageChange }) {
      return (
        <div style={{
          position: 'absolute',
          top: '20px',
          right: '20px',
          display: 'flex',
          gap: '10px',
        }}>
          {Object.keys(flags).map(lang => (
            <button
              key={lang}
              onClick={() => onLanguageChange(lang)}
              className={`flag-button ${lang === currentLang ? 'active' : ''}`}
              title={lang}
            >
              {flags[lang]}
            </button>
          ))}
        </div>
      );
    }

    function App() {
      // ç‹€æ…‹è®Šæ•¸
      const [language, setLanguage] = React.useState('zh-TW');
      const [firstVisitDate, setFirstVisitDate] = React.useState('');
      const [firstVisitYear, setFirstVisitYear] = React.useState('');
      const [firstVisitMonth, setFirstVisitMonth] = React.useState('');
      const [firstVisitDay, setFirstVisitDay] = React.useState('');
      const [actualSecondRefillDate, setActualSecondRefillDate] = React.useState('');
      const [actualSecondYear, setActualSecondYear] = React.useState('');
      const [actualSecondMonth, setActualSecondMonth] = React.useState('');
      const [actualSecondDay, setActualSecondDay] = React.useState('');
      const [prescriptionDays, setPrescriptionDays] = React.useState('28');
      const [refillTimes, setRefillTimes] = React.useState('3');
      const [results, setResults] = React.useState(null);
      const [today, setToday] = React.useState('');
      const [isCalculating, setIsCalculating] = React.useState(false);

      // ç•¶å‰èªè¨€çš„ç¿»è­¯
      const t = translations[language];

      // å»ºç«‹å¹´ä»½é¸é …
      const currentYear = new Date().getFullYear();
      const years = Array.from({ length: 10 }, (_, i) => currentYear - 5 + i);
      
      // å»ºç«‹æœˆä»½é¸é …
      const months = Array.from({ length: 12 }, (_, i) => i + 1);
      
      // å»ºç«‹æ—¥æœŸé¸é …
      const getDaysInMonth = (year, month) => {
        return new Date(year, month, 0).getDate();
      };

      // æ ¹æ“šé¸æ“‡çš„å¹´æœˆè¨ˆç®—å¯ç”¨çš„æ—¥æœŸ
      const getAvailableDays = (year, month) => {
        if (!year || !month) return Array.from({ length: 31 }, (_, i) => i + 1);
        const daysInMonth = getDaysInMonth(parseInt(year), parseInt(month));
        return Array.from({ length: daysInMonth }, (_, i) => i + 1);
      };
      
      const firstVisitDays = getAvailableDays(firstVisitYear, firstVisitMonth);
      const actualSecondDays = getAvailableDays(actualSecondYear, actualSecondMonth);

      // è¨­ç½®ä»Šå¤©çš„æ—¥æœŸ
      React.useEffect(() => {
        const date = new Date();
        const formattedDate = date.toISOString().split('T')[0];
        setToday(formattedDate);
        
        // è¨­ç½®åˆå§‹æ—¥æœŸç‚ºä»Šå¤©
        const currentYear = date.getFullYear().toString();
        const currentMonth = (date.getMonth() + 1).toString().padStart(2, '0');
        const currentDay = date.getDate().toString().padStart(2, '0');
        
        setFirstVisitYear(currentYear);
        setFirstVisitMonth(currentMonth);
        setFirstVisitDay(currentDay);
        updateFirstVisitDate(currentYear, currentMonth, currentDay);
        
        // æª¢æŸ¥ç€è¦½å™¨èªè¨€è¨­ç½®ï¼Œè¨­ç½®åˆå§‹èªè¨€
        const browserLang = navigator.language || navigator.userLanguage;
        if (browserLang.startsWith('zh')) {
          setLanguage('zh-TW');
        } else if (browserLang.startsWith('vi')) {
          setLanguage('vi-VN');
        } else {
          setLanguage('en-US'); // é»˜èªè‹±èª
        }
      }, []);
      
      // è™•ç†è™•æ–¹å¤©æ•¸è®Šæ›´ï¼Œç¢ºä¿æœ‰æ•ˆçš„é ˜è—¥æ¬¡æ•¸
      React.useEffect(() => {
        // å¦‚æœå¤©æ•¸å¤§æ–¼22å¤©ï¼Œä¸”é¸æ“‡äº†4æ¬¡ï¼Œå‰‡é‡ç½®ç‚º3æ¬¡
        if (parseInt(prescriptionDays) > 22 && refillTimes === '4') {
          setRefillTimes('3');
        }
      }, [prescriptionDays, refillTimes]);
      
      // ç•¶å¹´æœˆæ—¥é¸æ“‡è®ŠåŒ–æ™‚æ›´æ–°æ—¥æœŸå­—ä¸²
      const updateFirstVisitDate = (year, month, day) => {
        if (year && month && day) {
          const formattedMonth = month.padStart(2, '0');
          const formattedDay = day.padStart(2, '0');
          setFirstVisitDate(`${year}-${formattedMonth}-${formattedDay}`);
        }
      };
      
      const updateActualSecondDate = (year, month, day) => {
        if (year && month && day) {
          const formattedMonth = month.padStart(2, '0');
          const formattedDay = day.padStart(2, '0');
          setActualSecondRefillDate(`${year}-${formattedMonth}-${formattedDay}`);
        } else {
          setActualSecondRefillDate('');
        }
      };
      
      // ç•¶å¹´æœˆæ—¥é¸æ“‡è®ŠåŒ–æ™‚æ›´æ–°æ—¥æœŸ
      React.useEffect(() => {
        updateFirstVisitDate(firstVisitYear, firstVisitMonth, firstVisitDay);
      }, [firstVisitYear, firstVisitMonth, firstVisitDay]);
      
      React.useEffect(() => {
        updateActualSecondDate(actualSecondYear, actualSecondMonth, actualSecondDay);
      }, [actualSecondYear, actualSecondMonth, actualSecondDay]);

      // æ ¼å¼åŒ–æ—¥æœŸé¡¯ç¤º
      const formatDateForDisplay = (date) => {
        const d = new Date(date);
        
        // æ ¹æ“šç•¶å‰èªè¨€æ ¼å¼åŒ–æ—¥æœŸ
        if (language === 'zh-TW') {
          return `${d.getFullYear()}å¹´${d.getMonth()+1}æœˆ${d.getDate()}æ—¥`;
        } else if (language === 'vi-VN') {
          return `${d.getDate()}/${d.getMonth()+1}/${d.getFullYear()}`;
        } else {
          // è‹±æ–‡æ ¼å¼
          const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
          return `${months[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`;
        }
      };

      // è¨ˆç®—é ˜è—¥æ—¥æœŸå’Œå›è¨ºæ—¥æœŸ
      const calculateDates = () => {
        if (!firstVisitDate) {
          alert(t.pleaseSelectVisitDate);
          return;
        }

        // é¡¯ç¤ºè¨ˆç®—å‹•ç•«
        setIsCalculating(true);
        
        // å…ˆæ¸…ç©ºçµæœï¼Œè®“ç”¨æˆ¶çŸ¥é“æ­£åœ¨é‡æ–°è¨ˆç®—
        setResults(null);
        
        // ä½¿ç”¨requestAnimationFrameä¾†ç¢ºä¿UIæ›´æ–°å¾Œå†é€²è¡Œè¨ˆç®—
        requestAnimationFrame(() => {
          const days = parseInt(prescriptionDays);
          const times = parseInt(refillTimes);
          
          // è¨ˆç®—æ¨™æº–é ˜è—¥æ—¥æœŸ
          const firstDate = new Date(firstVisitDate);
          
          // ç¬¬ä¸€æ¬¡é ˜è—¥æ˜¯åœ¨å°±è¨ºç•¶å¤©
          const firstRefillDate = new Date(firstDate);
          
          // è¨ˆç®—æœ€æ—©ç¬¬äºŒæ¬¡é ˜è—¥æ—¥æœŸï¼ˆå‰©é¤˜è—¥å“ä¸è¶³10å¤©æ™‚ï¼‰
          const earliestSecondRefill = new Date(firstDate);
          earliestSecondRefill.setDate(firstDate.getDate() + days - 10);
          
          // è¨ˆç®—æ¨™æº–ç¬¬äºŒæ¬¡é ˜è—¥æ—¥æœŸ
          const standardSecondRefill = new Date(firstDate);
          standardSecondRefill.setDate(firstDate.getDate() + days);
          
          // è¨ˆç®—90å¤©è™•æ–¹æœ‰æ•ˆæœŸçµæŸæ—¥æœŸ
          const validityEndDate = new Date(firstDate);
          validityEndDate.setDate(firstDate.getDate() + 90);
          
          // è™•ç†å¯¦éš›ç¬¬äºŒæ¬¡é ˜è—¥æ—¥æœŸï¼ˆå¦‚æœ‰ï¼‰
          let thirdRefillDate, earliestThirdRefill, isThirdRefillValid = true;
          if (actualSecondRefillDate) {
            // å¦‚æœç”¨æˆ¶æŒ‡å®šäº†å¯¦éš›ç¬¬äºŒæ¬¡é ˜è—¥æ—¥æœŸ
            const actualDate = new Date(actualSecondRefillDate);
            
            // æ ¹æ“šå¯¦éš›ç¬¬äºŒæ¬¡é ˜è—¥è¨ˆç®—æœ€æ—©ç¬¬ä¸‰æ¬¡é ˜è—¥
            earliestThirdRefill = new Date(actualDate);
            earliestThirdRefill.setDate(actualDate.getDate() + days - 10);
            
            // è¨ˆç®—æ¨™æº–ç¬¬ä¸‰æ¬¡é ˜è—¥æ—¥æœŸ
            thirdRefillDate = new Date(actualDate);
            thirdRefillDate.setDate(actualDate.getDate() + days);
            
            // æª¢æŸ¥ç¬¬ä¸‰æ¬¡é ˜è—¥æ˜¯å¦è¶…éè™•æ–¹æœ‰æ•ˆæœŸ
            if (thirdRefillDate > validityEndDate) {
              isThirdRefillValid = false;
            }
          } else {
            // æ ¹æ“šæ¨™æº–ç¬¬äºŒæ¬¡é ˜è—¥æ—¥æœŸè¨ˆç®—
            earliestThirdRefill = new Date(standardSecondRefill);
            earliestThirdRefill.setDate(standardSecondRefill.getDate() + days - 10);
            
            thirdRefillDate = new Date(standardSecondRefill);
            thirdRefillDate.setDate(standardSecondRefill.getDate() + days);
            
            // æª¢æŸ¥ç¬¬ä¸‰æ¬¡é ˜è—¥æ˜¯å¦è¶…éè™•æ–¹æœ‰æ•ˆæœŸ
            if (thirdRefillDate > validityEndDate) {
              isThirdRefillValid = false;
            }
          }
          
          // å¦‚é©ç”¨ï¼Œè¨ˆç®—ç¬¬å››æ¬¡é ˜è—¥æ—¥æœŸ
          let fourthRefillDate, earliestFourthRefill, isFourthRefillValid = true;
          if (times > 3) {
            earliestFourthRefill = new Date(thirdRefillDate);
            earliestFourthRefill.setDate(thirdRefillDate.getDate() + days - 10);
            
            fourthRefillDate = new Date(thirdRefillDate);
            fourthRefillDate.setDate(thirdRefillDate.getDate() + days);
            
            // æª¢æŸ¥ç¬¬å››æ¬¡é ˜è—¥æ˜¯å¦è¶…éè™•æ–¹æœ‰æ•ˆæœŸ
            if (fourthRefillDate > validityEndDate || !isThirdRefillValid) {
              isFourthRefillValid = false;
            }
          }
          
          // æ ¹æ“šæœ€å¾Œä¸€æ¬¡æœ‰æ•ˆé ˜è—¥è¨ˆç®—ä¸‹æ¬¡å›è¨ºæ—¥æœŸ
          let nextVisitDate, earliestNextVisit;
          
          // è¨ˆç®—æœ€å¾Œä¸€æ¬¡è™•æ–¹ç”¨å®Œçš„æ—¥æœŸ
          const lastPrescriptionDate = times === 2 ? standardSecondRefill : 
                                    times === 3 ? (isThirdRefillValid ? thirdRefillDate : (actualSecondRefillDate ? new Date(actualSecondRefillDate) : standardSecondRefill)) : 
                                    (isFourthRefillValid ? fourthRefillDate : (isThirdRefillValid ? thirdRefillDate : (actualSecondRefillDate ? new Date(actualSecondRefillDate) : standardSecondRefill)));
          
          // æœ€æ—©å›è¨ºæ—¥æœŸï¼ˆè—¥å“å‰©é¤˜ä¸è¶³10å¤©ï¼‰
          earliestNextVisit = new Date(lastPrescriptionDate);
          earliestNextVisit.setDate(lastPrescriptionDate.getDate() + days - 10);
          
          // æ¨™æº–å›è¨ºæ—¥æœŸï¼ˆè—¥å“ç”¨å®Œæ™‚ï¼‰
          nextVisitDate = new Date(lastPrescriptionDate);
          nextVisitDate.setDate(lastPrescriptionDate.getDate() + days);
          
          // å„²å­˜çµæœ
          setResults({
            firstVisitDate: firstDate,
            earliestSecondRefill: earliestSecondRefill,
            standardSecondRefill: standardSecondRefill,
            actualSecondRefill: actualSecondRefillDate ? new Date(actualSecondRefillDate) : null,
            earliestThirdRefill: earliestThirdRefill,
            thirdRefillDate: thirdRefillDate,
            isThirdRefillValid: isThirdRefillValid,
            earliestFourthRefill: times > 3 ? earliestFourthRefill : null,
            fourthRefillDate: times > 3 ? fourthRefillDate : null,
            isFourthRefillValid: times > 3 ? isFourthRefillValid : false,
            earliestNextVisit: earliestNextVisit,
            nextVisitDate: nextVisitDate,
            validityEndDate: validityEndDate,
            calculatedAt: new Date().getTime() // æ·»åŠ è¨ˆç®—æ™‚é–“æˆ³è¨˜ï¼Œç¢ºä¿æ¯æ¬¡è¨ˆç®—éƒ½æœ‰ä¸åŒçš„çµæœå°è±¡
          });
          
          // éš±è—è¨ˆç®—å‹•ç•«
          setIsCalculating(false);
          
          // è¨ˆç®—å®Œæˆå¾Œæ»¾å‹•åˆ°çµæœå€åŸŸ
          const resultsElement = document.getElementById('results-section');
          if (resultsElement) {
            resultsElement.scrollIntoView({ behavior: 'smooth' });
          }
        });
      };

      // é é¢æ¨£å¼
      const styles = {
        app: {
          minHeight: '100vh',
          padding: '20px',
          position: 'relative',
        },
        container: {
          maxWidth: '800px',
          margin: '0 auto',
        },
        title: {
          fontSize: '24px',
          textAlign: 'center',
          marginBottom: '20px',
          color: '#333',
          fontWeight: 'bold',
          paddingTop: '40px', // ç‚ºèªè¨€åˆ‡æ›å™¨ç•™å‡ºç©ºé–“
        },
        card: {
          background: 'white',
          borderRadius: '8px',
          boxShadow: '0 2px 10px rgba(0, 0, 0, 0.1)',
          padding: '20px',
          marginBottom: '20px',
        },
        formGroup: {
          marginBottom: '20px',
        },
        label: {
          display: 'block',
          marginBottom: '5px',
          fontWeight: '500',
        },
        required: {
          color: '#e53e3e',
        },
        formControl: {
          width: '100%',
          padding: '10px',
          border: '1px solid #ddd',
          borderRadius: '4px',
          fontSize: '16px',
        },
        buttonContainer: {
          marginTop: '20px',
          textAlign: 'center',
        },
        calculateButton: {
          backgroundColor: '#4299e1',
          color: 'white',
          border: 'none',
          borderRadius: '4px',
          padding: '10px 20px',
          fontSize: '16px',
          cursor: 'pointer',
          fontWeight: '500',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          margin: '0 auto',
          minWidth: '180px',
        },
      };

      // æ›´æ–°ç¶²é æ¨™é¡Œå’Œèªè¨€
      React.useEffect(() => {
        // æ›´æ–°HTMLæ¨™ç±¤çš„langå±¬æ€§
        document.documentElement.setAttribute('lang', language);
        
        // æ›´æ–°é é¢æ¨™é¡Œ
        document.title = `${t.title}`;
      }, [language, t.title]);

      return (
        <div style={styles.app}>
          <div style={styles.container}>
            <LanguageSwitcher 
              currentLang={language} 
              onLanguageChange={setLanguage}
            />
            
            <h1 style={styles.title}>{t.title}</h1>
            
            <div style={styles.card}>
              <div style={{
                display: 'grid',
                gridTemplateColumns: window.innerWidth > 768 ? '1fr 1fr' : '1fr',
                gap: '15px'
              }}>
                <div style={styles.formGroup}>
                  <label style={styles.label}>
                    {t.firstVisitDate} <span style={styles.required}>*</span>
                  </label>
                  <div style={{ display: 'flex', gap: '10px' }}>
                    <select 
                      style={{ ...styles.formControl, flex: 1 }}
                      value={firstVisitYear}
                      onChange={(e) => setFirstVisitYear(e.target.value)}
                    >
                      <option value="">{t.selectYear}</option>
                      {years.map(year => (
                        <option key={year} value={year}>{year} {t.year}</option>
                      ))}
                    </select>
                    
                    <select 
                      style={{ ...styles.formControl, flex: 1 }}
                      value={firstVisitMonth}
                      onChange={(e) => {
                        const newMonth = e.target.value;
                        setFirstVisitMonth(newMonth);
                        
                        // ç•¶é¸æ“‡çš„æœˆä»½è®ŠåŒ–æ™‚ï¼Œæª¢æŸ¥æ—¥æœŸæ˜¯å¦æœ‰æ•ˆ
                        if (firstVisitDay) {
                          const daysInNewMonth = getDaysInMonth(parseInt(firstVisitYear), parseInt(newMonth));
                          if (parseInt(firstVisitDay) > daysInNewMonth) {
                            setFirstVisitDay(daysInNewMonth.toString());
                          }
                        }
                      }}
                    >
                      <option value="">{t.selectMonth}</option>
                      {months.map(month => (
                        <option key={month} value={month.toString().padStart(2, '0')}>{month} {t.month}</option>
                      ))}
                    </select>
                    
                    <select 
                      style={{ ...styles.formControl, flex: 1 }}
                      value={firstVisitDay}
                      onChange={(e) => setFirstVisitDay(e.target.value)}
                    >
                      <option value="">{t.selectDay}</option>
                      {firstVisitDays.map(day => (
                        <option key={day} value={day.toString().padStart(2, '0')}>{day} {t.day}</option>
                      ))}
                    </select>
                  </div>
                </div>
                
                <div style={styles.formGroup}>
                  <label style={styles.label}>
                    {t.prescriptionDays} <span style={styles.required}>*</span>
                  </label>
                  <select
                    style={styles.formControl}
                    value={prescriptionDays}
                    onChange={(e) => setPrescriptionDays(e.target.value)}
                  >
                    {Array.from({ length: 10 }, (_, i) => i + 21).map(day => (
                      <option key={day} value={day.toString()}>{day} {t.days}</option>
                    ))}
                  </select>
                </div>
                
                <div style={styles.formGroup}>
                  <label style={styles.label}>
                    {t.refillTimes} <span style={styles.required}>*</span>
                  </label>
                  <select
                    style={styles.formControl}
                    value={refillTimes}
                    onChange={(e) => setRefillTimes(e.target.value)}
                  >
                    <option value="2">2 {t.times}</option>
                    <option value="3">3 {t.times}</option>
                    {parseInt(prescriptionDays) <= 22 && <option value="4">4 {t.times}</option>}
                  </select>
                </div>
                
                <div style={styles.formGroup}>
                  <label style={styles.label}>
                    {t.actualSecondRefillDate}
                  </label>
                  <div style={{ display: 'flex', gap: '10px' }}>
                    <select 
                      style={{ ...styles.formControl, flex: 1 }}
                      value={actualSecondYear}
                      onChange={(e) => setActualSecondYear(e.target.value)}
                    >
                      <option value="">{t.selectYear}</option>
                      {years.map(year => (
                        <option key={year} value={year}>{year} {t.year}</option>
                      ))}
                    </select>
                    
                    <select 
                      style={{ ...styles.formControl, flex: 1 }}
                      value={actualSecondMonth}
                      onChange={(e) => {
                        const newMonth = e.target.value;
                        setActualSecondMonth(newMonth);
                        
                        // ç•¶é¸æ“‡çš„æœˆä»½è®ŠåŒ–æ™‚ï¼Œæª¢æŸ¥æ—¥æœŸæ˜¯å¦æœ‰æ•ˆ
                        if (actualSecondDay) {
                          const daysInNewMonth = getDaysInMonth(parseInt(actualSecondYear), parseInt(newMonth));
                          if (parseInt(actualSecondDay) > daysInNewMonth) {
                            setActualSecondDay(daysInNewMonth.toString());
                          }
                        }
                      }}
                      disabled={!actualSecondYear}
                    >
                      <option value="">{t.selectMonth}</option>
                      {months.map(month => (
                        <option key={month} value={month.toString().padStart(2, '0')}>{month} {t.month}</option>
                      ))}
                    </select>
                    
                    <select 
                      style={{ ...styles.formControl, flex: 1 }}
                      value={actualSecondDay}
                      onChange={(e) => setActualSecondDay(e.target.value)}
                      disabled={!actualSecondMonth}
                    >
                      <option value="">{t.selectDay}</option>
                      {actualSecondDays.map(day => (
                        <option key={day} value={day.toString().padStart(2, '0')}>{day} {t.day}</option>
                      ))}
                    </select>
                  </div>
                </div>
              </div>
              
              <div style={styles.buttonContainer}>
                <button
                  style={{
                    ...styles.calculateButton,
                    cursor: isCalculating ? 'wait' : 'pointer',
                    opacity: isCalculating ? 0.8 : 1,
                  }}
                  onClick={calculateDates}
                  disabled={isCalculating}
                >
                  {isCalculating ? (
                    <>
                      <div style={{
                        width: '20px',
                        height: '20px',
                        border: '3px solid rgba(255,255,255,0.3)',
                        borderRadius: '50%',
                        borderTopColor: 'white',
                        animation: 'spin 1s linear infinite',
                        marginRight: '10px',
                      }}></div>
                      {t.calculating}
                    </>
                  ) : (
                    t.calculateButton
                  )}
                </button>
              </div>
            </div>
            
            {results && (
              <div id="results-section" style={{...styles.card, marginTop: '30px', animation: 'fadeIn 0.5s ease-in'}}>
                <h2 style={{
                  fontSize: '20px',
                  marginBottom: '15px',
                  borderBottom: '1px solid #eee',
                  paddingBottom: '10px',
                }}>{t.results}</h2>
                
                <div style={{
                  display: 'flex',
                  flexDirection: 'column',
                  gap: '20px',
                }}>
                  <div style={{
                    paddingBottom: '15px',
                    borderBottom: '1px solid #eee',
                    animation: 'slideDown 0.3s ease-out',
                  }}>
                    <h3 style={{
                      fontSize: '18px',
                      marginBottom: '10px',
                      color: '#4a5568',
                    }}>{t.prescriptionInfo}</h3>
                    <p><span style={{fontWeight: '600'}}>{t.firstRefillDate}ï¼š</span> {formatDateForDisplay(results.firstVisitDate)}</p>
                    <p><span style={{fontWeight: '600'}}>{t.validityEndDate}ï¼š</span> {formatDateForDisplay(results.validityEndDate)} {t.validityEndDateSuffix}</p>
                  </div>
                  
                  <div style={{
                    paddingBottom: '15px',
                    borderBottom: '1px solid #eee',
                    animation: 'slideDown 0.3s ease-out 0.1s',
                    animationFillMode: 'both',
                  }}>
                    <h3 style={{
                      fontSize: '18px',
                      marginBottom: '10px',
                      color: '#4a5568',
                    }}>{t.secondRefill}</h3>
                    <p>
                      <span style={{fontWeight: '600'}}>{t.earliestRefillDate}ï¼š</span> 
                      <span style={{color: '#3182ce', fontWeight: '600'}}>{formatDateForDisplay(results.earliestSecondRefill)}</span> 
                      {t.remainingLessThan10Days}
                    </p>
                    <p>
                      <span style={{fontWeight: '600'}}>{t.standardRefillDate}ï¼š</span> 
                      {formatDateForDisplay(results.standardSecondRefill)} 
                      {t.medicationEmptyDate}
                    </p>
                    {results.actualSecondRefill && (
                      <p>
                        <span style={{fontWeight: '600'}}>{t.actualRefillDate}ï¼š</span> 
                        {formatDateForDisplay(results.actualSecondRefill)}
                      </p>
                    )}
                  </div>
                  
                  {parseInt(refillTimes) >= 3 && (
                    <div style={{
                      paddingBottom: '15px',
                      borderBottom: '1px solid #eee',
                      animation: 'slideDown 0.3s ease-out 0.2s',
                      animationFillMode: 'both',
                    }}>
                      <h3 style={{
                        fontSize: '18px',
                        marginBottom: '10px',
                        color: '#4a5568',
                      }}>{t.thirdRefill}</h3>
                      {results.isThirdRefillValid ? (
                        <>
                          <p>
                            <span style={{fontWeight: '600'}}>{t.earliestRefillDate}ï¼š</span> 
                            <span style={{color: '#3182ce', fontWeight: '600'}}>{formatDateForDisplay(results.earliestThirdRefill)}</span> 
                            {t.remainingLessThan10Days}
                          </p>
                          <p>
                            <span style={{fontWeight: '600'}}>{t.standardRefillDate}ï¼š</span> 
                            {formatDateForDisplay(results.thirdRefillDate)} 
                            {t.medicationEmptyDate}
                          </p>
                        </>
                      ) : (
                        <p style={{color: '#e53e3e', fontWeight: '500'}}>
                          {t.refillDateInvalid} ({formatDateForDisplay(results.validityEndDate)})
                        </p>
                      )}
                    </div>
                  )}
                  
                  {parseInt(refillTimes) >= 4 && results.earliestFourthRefill && (
                    <div style={{
                      paddingBottom: '15px',
                      borderBottom: '1px solid #eee',
                      animation: 'slideDown 0.3s ease-out 0.3s',
                      animationFillMode: 'both',
                    }}>
                      <h3 style={{
                        fontSize: '18px',
                        marginBottom: '10px',
                        color: '#4a5568',
                      }}>{t.fourthRefill}</h3>
                      {results.isFourthRefillValid ? (
                        <>
                          <p>
                            <span style={{fontWeight: '600'}}>{t.earliestRefillDate}ï¼š</span> 
                            <span style={{color: '#3182ce', fontWeight: '600'}}>{formatDateForDisplay(results.earliestFourthRefill)}</span> 
                            {t.remainingLessThan10Days}
                          </p>
                          <p>
                            <span style={{fontWeight: '600'}}>{t.standardRefillDate}ï¼š</span> 
                            {formatDateForDisplay(results.fourthRefillDate)} 
                            {t.medicationEmptyDate}
                          </p>
                        </>
                      ) : (
                        <p style={{color: '#e53e3e', fontWeight: '500'}}>
                          {t.refillDateInvalid} ({formatDateForDisplay(results.validityEndDate)})
                        </p>
                      )}
                    </div>
                  )}
                  
                  <div style={{
                    paddingBottom: '15px',
                    animation: 'slideDown 0.3s ease-out 0.4s',
                    animationFillMode: 'both',
                  }}>
                    <h3 style={{
                      fontSize: '18px',
                      marginBottom: '10px',
                      color: '#4a5568',
                    }}>{t.nextVisit}</h3>
                    <p>
                      <span style={{fontWeight: '600'}}>{t.earliestNextVisitDate}ï¼š</span> 
                      <span style={{color: '#38a169',<!DOCTYPE html>
<html lang="zh-TW">
